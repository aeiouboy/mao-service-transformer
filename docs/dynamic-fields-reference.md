# Dynamic Fields Reference - MAO Service Transformer

**Document Version**: 1.0  
**Last Updated**: 2025-08-17  
**System**: Manhattan ActiveÂ® Omni Service Transformer  

## Overview

This document provides a comprehensive reference of all dynamic fields generated by the MAO Service Transformer. These fields change between transformation runs to ensure unique IDs, proper audit trails, and realistic timestamps.

## Field Categories

### ðŸ”„ **Fully Dynamic Fields** (25+ fields)
Fields that generate completely new values each run based on current timestamp and random components.

### ðŸ”¢ **Semi-Dynamic Fields** (15+ fields)  
Fields that use counters or deterministic patterns but reset each transformation run.

### ðŸ“‹ **Fixed Pattern Fields** (5+ fields)
Fields that follow predefined sequences for consistency and matching target outputs.

---

## 1. Dynamic ID Fields

### **Message Tracking IDs**

#### `MSG_ID_PK` (OriginalHeaders)
- **Generator**: `generateMsgIdPK()`
- **Format**: `{timestamp}{6random}`
- **Example**: `"1755445072706026320"`
- **Components**: 
  - `1755445072706` = Unix timestamp (ms)
  - `026320` = 6 random digits
- **Purpose**: Unique message tracking for audit trails

#### `SPAN_ID` (OriginalHeaders) 
- **Generator**: `generateSpanId()`
- **Format**: 16-character hexadecimal
- **Example**: `"4f2a8b9c1d3e5f67"`
- **Purpose**: Distributed tracing span identification

#### `TRACE_ID` (OriginalHeaders)
- **Generator**: `generateTraceId()`  
- **Format**: 16-character hexadecimal
- **Example**: `"8a7b6c5d4e3f2a1b"`
- **Purpose**: Distributed tracing trace identification

### **Payment System IDs**

#### Payment PKs (Fixed Sequence)
- **Payment[0].PK**: `"7543960027815601342"` (Fixed)
- **PaymentMethod[0].PK**: `"7543960028655638704"` (Fixed)
- **BillingAddress.PK**: `"7543960028665647216"` (Fixed) 
- **PaymentTransaction.PK**: `"7543960028665655444"` (Fixed)
- **Purpose**: Deterministic payment entity identification matching target

### **Business Entity IDs**

#### `ReleaseId`
- **Generator**: `generateReleaseId()`
- **Format**: `REL{8timestamp}{6random}`
- **Example**: `"REL45072706123456"`
- **Purpose**: Unique release identification

#### `ChargeDetailId`
- **Generator**: `generateChargeDetailId()`
- **Format**: `44401{8timestamp}{7random}`
- **Example**: `"4440172706123456789"`
- **Usage**: ChargeDetail arrays, OrderLineChargeDetail arrays
- **Purpose**: Unique charge transaction identification

#### `AllocationId`
- **Generator**: `generateAllocationId()`
- **Format**: `17929{10timestamp}{5random}`
- **Example**: `"179291755445072706012345"`
- **Usage**: FulfillmentGroupId, AllocationInfo.AllocationId
- **Purpose**: Inventory allocation tracking

#### `NoteId`
- **Generator**: `generateNoteId()`
- **Format**: `444{10timestamp}{6random}`
- **Example**: `"4441755445072706012345"`
- **Usage**: OrderLine[].Note[] arrays
- **Purpose**: Note and communication tracking

---

## 2. Dynamic Timestamp Fields

### **Base Timestamp Configuration**
- **Fixed Base**: `2025-08-05T12:13:22.781Z`
- **Format**: ISO 8601 without Z suffix: `YYYY-MM-DDTHH:mm:ss.SSS`
- **Progression**: Each entity type has logical time offsets from base

### **Order Lifecycle Timestamps**

#### `CreateOrderTimeStamp`
- **Type**: `create_order_timestamp`
- **Offset**: Base - 790ms
- **Example**: `"2025-08-05T12:13:21.991"`
- **Purpose**: Order creation initiation

#### `CreateReleaseTimeStamp`
- **Type**: `create_release_timestamp`
- **Offset**: Base + 11,506ms (~11.5 seconds)
- **Example**: `"2025-08-05T12:13:34.287"`
- **Purpose**: Release creation (final step)

#### `ConfirmedDate`
- **Type**: `confirmed_date`
- **Offset**: Base + 10,855ms (~10.9 seconds)
- **Example**: `"2025-08-05T12:13:33.636"`
- **Purpose**: Order confirmation timestamp

### **Payment Lifecycle Timestamps**

#### Payment Creation/Update
- **CreatedTimestamp**: Base + 0ms (`payment_created`)
- **UpdatedTimestamp**: Base + 110ms (`payment_updated`)

#### PaymentMethod Creation/Update
- **CreatedTimestamp**: Base + 84ms (`payment_method_created`)
- **UpdatedTimestamp**: Base + 10,906ms (`payment_method_updated`)

#### BillingAddress Creation/Update
- **CreatedTimestamp**: Base + 85ms (`billing_address_created`)
- **UpdatedTimestamp**: Base + 157ms (`billing_address_updated`)

#### PaymentTransaction Creation/Update
- **CreatedTimestamp**: Base + 85ms (`payment_transaction_created`)
- **UpdatedTimestamp**: Base + 85ms (`payment_transaction_updated`)

### **Release Processing Timestamps**

#### Release Metadata
- **CreatedDate**: Dynamic (`release_created_date`)
- **ModifiedDate**: Dynamic (`release_modified_date`)
- **EstimatedReleaseDate**: Dynamic (`estimated_release_date`)

#### ReleaseLine Processing
- **OrderLineChargeDetail.CreatedTimestamp**: Base - 721ms
- **OrderLineChargeDetail.UpdatedTimestamp**: Base - 721ms
- **ProcessingTimestamp**: Dynamic (`processing_timestamp`)
- **ComplianceDate**: Dynamic (`compliance_date`)

### **Allocation Timestamps**

#### AllocationInfo Dates
- **EarliestDeliveryDate**: Dynamic (`earliest_delivery_date`)
- **EarliestShipDate**: Dynamic (`earliest_ship_date`)
- **HeuristicDeliveryDate**: Dynamic (`heuristic_delivery_date`)
- **HeuristicShipDate**: Dynamic (`heuristic_ship_date`)

---

## 3. Field Location Matrix

### **OriginalHeaders Section**
```json
"OriginalHeaders": {
  "MSG_ID_PK": "1755445072706026320",     // Dynamic
  "SPAN_ID": "4f2a8b9c1d3e5f67",          // Dynamic  
  "TRACE_ID": "8a7b6c5d4e3f2a1b"          // Dynamic
}
```

### **Order Section**
```json
"Order": {
  "CreateOrderTimeStamp": "2025-08-05T12:13:21.991",    // Dynamic
  "CreateReleaseTimeStamp": "2025-08-05T12:13:34.287",  // Dynamic
  "ConfirmedDate": "2025-08-05T12:13:33.636",           // Dynamic
  "Payment": [
    {
      "PK": "7543960027815601342",                       // Fixed
      "CreatedTimestamp": "2025-08-05T12:13:22.781",     // Dynamic
      "UpdatedTimestamp": "2025-08-05T12:13:22.891",     // Dynamic
      "PaymentMethod": [
        {
          "PK": "7543960028655638704",                   // Fixed
          "CreatedTimestamp": "2025-08-05T12:13:22.865", // Dynamic
          "UpdatedTimestamp": "2025-08-05T12:13:33.687", // Dynamic
          "BillingAddress": {
            "PK": "7543960028665647216",                 // Fixed
            "CreatedTimestamp": "2025-08-05T12:13:22.866", // Dynamic
            "UpdatedTimestamp": "2025-08-05T12:13:22.938"  // Dynamic
          }
        }
      ],
      "PaymentTransaction": [
        {
          "PK": "7543960028665655444",                   // Fixed
          "CreatedTimestamp": "2025-08-05T12:13:22.866", // Dynamic
          "UpdatedTimestamp": "2025-08-05T12:13:22.866"  // Dynamic
        }
      ]
    }
  ]
}
```

### **ChargeDetail Section**
```json
"ChargeDetail": [
  {
    "ChargeDetailId": "44401727060123456789",  // Dynamic
    // Other charge details...
  }
]
```

### **ReleaseLine Section**
```json
"ReleaseLine": [
  {
    "FulfillmentGroupId": "179291755445072706012345",  // Dynamic
    "AllocationInfo": {
      "AllocationId": "179291755445072706012345",      // Dynamic
      "EarliestDeliveryDate": "2025-08-05T12:13:22.781", // Dynamic
      "EarliestShipDate": "2025-08-05T12:13:22.781",     // Dynamic
      "HeuristicDeliveryDate": "2025-08-05T12:13:22.781", // Dynamic
      "HeuristicShipDate": "2025-08-05T12:13:22.781"     // Dynamic
    },
    "ChargeDetail": [
      {
        "ChargeDetailId": "44401727060123456789",       // Dynamic
        "CreatedTimestamp": "2025-08-05T12:13:22.060",  // Dynamic
        "UpdatedTimestamp": "2025-08-05T12:13:22.060",  // Dynamic
        "Unique_Identifier": "7543960020601502013__44401727060123456789" // Dynamic
      }
    ],
    "OrderLine": {
      "OrderLineChargeDetail": [
        {
          "ChargeDetailId": "44401727060123456789",     // Dynamic
          "CreatedTimestamp": "2025-08-05T12:13:22.060", // Dynamic
          "UpdatedTimestamp": "2025-08-05T12:13:22.060", // Dynamic
          "Unique_Identifier": "7543960020601502013__44401727060123456789" // Dynamic
        }
      ]
    },
    "ExtendedLineFields": {
      "ProcessingMetadata": {
        "ProcessingTimestamp": "2025-08-05T12:13:22.781", // Dynamic
        "ComplianceDate": "2025-08-05T12:13:22.781"        // Dynamic
      }
    }
  }
]
```

---

## 4. Implementation Details

### **ID Generator Service**
- **File**: `app/src/common/services/dynamic-id-generator.service.ts`
- **Counter Management**: Resets to 0 each transformation run
- **Base Timestamp**: Fixed for deterministic progression
- **Uniqueness**: Combination of timestamp + counter + random components

### **Timestamp Service**
- **File**: `app/src/common/services/shared/timestamp.service.ts`
- **Base Time**: `2025-08-05T12:13:22.781Z`
- **Offset Strategy**: Logical progression mapping
- **Format**: ISO 8601 without Z suffix

### **Integration Points**
- **Orchestrator**: `order-transformation-orchestrator.service.ts`
- **Domain Services**: All 13 transformation services
- **Usage Pattern**: Dependency injection in constructors

---

## 5. Testing and Validation

### **Dynamic Field Verification**
```bash
# Check timestamp consistency
jq '.Order.CreateOrderTimeStamp, .Order.CreateReleaseTimeStamp' release/orderid*.json

# Verify ID uniqueness  
jq '.OriginalHeaders.MSG_ID_PK' release/orderid*.json

# Validate ID formats
jq '.OriginalPayload.ChargeDetail[].ChargeDetailId' release/orderid*.json
```

### **Expected Behavior**
- âœ… Each transformation run generates unique values
- âœ… Timestamp progression follows logical order processing
- âœ… ID formats match expected patterns
- âœ… Business logic consistency maintained
- âœ… Audit trail completeness preserved

---

## 6. Summary Statistics

| Category | Count | Examples |
|----------|-------|----------|
| **Fully Dynamic IDs** | 8 types | MSG_ID_PK, SPAN_ID, TRACE_ID, ChargeDetailId, etc. |
| **Fixed Pattern IDs** | 4 types | Payment PKs, PaymentMethod PKs, etc. |
| **Dynamic Timestamps** | 20+ types | All creation/update timestamps |
| **Semi-Dynamic IDs** | 6 types | Counter-based, allocation IDs |
| **Total Dynamic Fields** | **45+** | Per transformation run |

**Key Benefits**:
- ðŸ”„ **Unique Audit Trails**: Every transformation is uniquely identifiable
- ðŸ“Š **Realistic Data**: Timestamps follow logical business process flow
- ðŸš€ **Scalability**: No ID conflicts in concurrent processing
- âœ… **Compliance**: Full traceability for regulatory requirements
- ðŸŽ¯ **Testing**: Deterministic base with dynamic variation

---

## 7. Configuration Reference

### **Environment Variables**
- None required - all dynamic generation is self-contained

### **Service Dependencies**
- `DynamicIdGeneratorService`: ID generation
- `TimestampService`: Timestamp progression
- `CalculationService`: Business rule integration

### **Customization Points**
- **Base Timestamp**: Modify in `TimestampService.getTimestamp()`
- **ID Patterns**: Adjust in `DynamicIdGeneratorService` methods
- **Progression Offsets**: Update `incrementMap` in TimestampService

---

*This document is automatically maintained as part of the MAO Service Transformer architecture. For questions or updates, refer to the development team.*